<odoo>

    <record id="document_view_kanban" model="ir.ui.view">
        <field name="model">documents.document</field>
        <field name="inherit_id" ref="documents.document_view_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[last()]" position="after">
                <field name="nextcloud_attachment"/>
                <field name="nextcloud_view_link"/>
                <field name="nextcloud_share_link"/>
            </xpath>
            <xpath expr="//t[@t-elif='webimage']" position="after">
                <t t-if="record.nextcloud_attachment.raw_value == true">
                    <img t-attf-src="/bf_nextcloud/static/description/nextcloud.png" alt="Nextcloud Thumbnail"/>
                </t>
            </xpath>
            <xpath expr='//t[@t-elif="webimage"]//img' position="attributes">
                <attribute name="t-if">
                    record.nextcloud_attachment.raw_value != true
                </attribute>
            </xpath>
            <xpath expr="//div[hasclass('o_kanban_record_body')]" position="inside">
                <div t-if="record.nextcloud_attachment.raw_value == true">
                    <strong>Nextcloud Share Link</strong>
                    <field name="nextcloud_share_link" widget="url"/>
                </div>
            </xpath>
        </field>
    </record>

    <template id="share_page" inherit_id="documents.share_page">
        <xpath expr="//a[@t-else='']" position="replace">
            <a t-elif="document.nextcloud_attachment" t-attf-href="#{document.nextcloud_share_link}/download"
               target="new"
               t-att-title="'Download ' + document.name"
               t-esc="document.name"/>
            <a t-else="" t-att-href="download_URL" target="new" t-att-title="'Download ' + document.name"
               t-esc="document.name"/>
        </xpath>
        <xpath expr="//div[hasclass('o_card_right')]" position="replace">
            <div class="o_card_right d-flex flex-column flex-nowrap justify-content-between text-right">
                <img t-attf-title="Owner: #{document.create_uid.name}" t-att-alt="document.create_uid.name"
                     class="o_object_fit_cover rounded-circle" width="15" height="15"
                     t-attf-src="/document/avatar/#{share_id}/#{token}"/>
                <a t-if="document.nextcloud_attachment" t-attf-href="#{document.nextcloud_share_link}/download"
                   target="new"
                   t-att-title="'Download ' + document.name">
                    <i t-attf-class="fa #{'url' not in document.type and 'fa-download' or 'fa-link'}"/>
                </a>
                <a t-elif="not document_request" t-att-href="download_URL" target="new"
                   t-att-title="'Download ' + document.name">
                    <i t-attf-class="fa #{'url' not in document.type and 'fa-download' or 'fa-link'}"/>
                </a>
            </div>
        </xpath>
        <xpath expr="//div[hasclass('o_image_preview')]" position="replace">
            <div t-if="document.nextcloud_attachment" class="o_image_preview">
                <img src="/bf_nextcloud/static/description/nextcloud.png"
                     alt="Nextcloud Share Link" class="w-100 h-100"/>
            </div>
            <div t-elif="document.mimetype and'image/' in document.mimetype" class="o_image_preview"
                 t-attf-style="background-image:url(/document/thumbnail/#{share_id}/#{token}/#{document.id})"/>
        </xpath>
    </template>

</odoo>
